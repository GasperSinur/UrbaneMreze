@model UrbaneMreze.Models.Spot

@{
    ViewBag.Title = "Podrobnosti";
}
<div class="container-fluid">
    <div class="row">
        <div class="row">
            <div id="map" class="col-sm-12 map-details"></div>
        </div>
        <div class="row">
            <div class="col-sm-6 details-field">
                <div class="row">
                    <div class="col-sm-12">
                        <h4>Podrobnosti</h4>
                        <dl class="dl-horizontal">
                            <dt>
                                @Html.DisplayNameFor(model => model.SpotName)
                            </dt>

                            <dd>
                                @Html.DisplayFor(model => model.SpotName)
                            </dd>

                            <dt>
                                @Html.DisplayNameFor(model => model.Description)
                            </dt>

                            <dd>
                                @Html.DisplayFor(model => model.Description)
                            </dd>

                            <dt>
                                @Html.DisplayNameFor(model => model.DateCreated)
                            </dt>

                            <dd>
                                @Html.DisplayFor(model => model.DateCreated)
                            </dd>

                            <dt>
                                @Html.DisplayNameFor(model => model.DateModified)
                            </dt>

                            <dd>
                                @Html.DisplayFor(model => model.DateModified)
                            </dd>

                            <dt>
                                @Html.DisplayNameFor(model => model.UserCreatedID)
                            </dt>

                            <dd>
                                @Html.DisplayFor(model => model.UserCreatedID)
                            </dd>

                            <dt>
                                @Html.DisplayNameFor(model => model.UserModifiedID)
                            </dt>

                            <dd>
                                @Html.DisplayFor(model => model.UserModifiedID)
                            </dd>
                        </dl>
                    </div>
                </div>
            </div>

            <div class="col-sm-6 details-field">
                <h4>Fotografija</h4>
                @foreach (var item in @ViewBag.Photos) {
                    <div class="col-sm-6">    
                        <img src="@item.Description" class="details-photo" />
                        <p><span class="bold-text">Datum nastanka: </span>@item.DateCreated</p>
                    </div>
                }
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <h4>Komentarji</h4>
            </div>
            <div class="col-sm-12 comments">
                @foreach (var item in ViewBag.Comments)
                {
                    <div class="row">
                        <div class="col-sm-2 comment">
                            <p class="bold-text">Gašper Sinur</p>
                            <p>@item.DateCreated</p>
                        </div>
                        <div class="col-sm-10">
                            <p class="bold-text">@item.Title</p>
                            @item.Text
                        </div>
                    </div>
                    <div class="row">
                        <hr />
                    </div>
                }

                @if (Request.IsAuthenticated)
                {
                    <p class="comment-login">
                        @Html.ActionLink("Komentiraj", "Create", "Comments")
                    </p>
                }
                else
                {
                    <div class="row">
                        <div class="col-sm-12">
                            <p class="comment-login">
                                Za pisanje komentarjev se morate @Html.ActionLink("prijaviti", "Login", "Account", routeValues: null, htmlAttributes: new { id = "loginLink" }).
                            </p>
                        </div>
                    </div>
                }
            </div>
        </div>

        <script>
        var markerDetails = @Html.Raw(@ViewBag.Marker);
        function initMap() {
            var myLatlng = new google.maps.LatLng(markerDetails.lat, markerDetails.lng);
            var mapOptions = {
                center: myLatlng,
                zoom: 16,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var infoWindow = new google.maps.InfoWindow();
            var map = new google.maps.Map(document.getElementById("map"), mapOptions);
            var marker = new google.maps.Marker({
                position: myLatlng,
                map: map,
                title: markerDetails.title
            });
            (function (marker, markerDetails) {
                google.maps.event.addListener(marker, "click", function (e) {
                    infoWindow.setContent(
                        "<div class='infoWindow'><span class='bold-text'>" + markerDetails.title + "</span><br/><p>" + markerDetails.description + "</p><p><a href='https://www.google.com/maps/?q="+markerDetails.lat+","+markerDetails.lng+"' target='_blank'>Prikaži v Google Zemljevidih</a></p></div>"
                    );
                    infoWindow.open(map, marker);
                });
            })(marker, markerDetails);
        }
        </script>

        <script async defer
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEAiYQrITQJClN12bmTuXXF4AQCkkiCRk&callback=initMap">
        </script>

    </div>
</div>